// iiif-metadata-component v1.1.8 https://github.com/iiif-commons/iiif-metadata-component#readme
!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.iiifMetadataComponent=f()}}(function(){return function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}return e}()({1:[function(require,module,exports){(function(global){var IIIFComponents;!function(IIIFComponents){var StringValue=function(){function StringValue(value){this.value="",value&&(this.value=value.toLowerCase())}return StringValue.prototype.toString=function(){return this.value},StringValue}();IIIFComponents.StringValue=StringValue}(IIIFComponents||(IIIFComponents={}));var IIIFComponents,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();!function(IIIFComponents){var MetadataComponentOptions;!function(MetadataComponentOptions){var LimitType=function(_super){function LimitType(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(LimitType,_super),LimitType.LINES=new LimitType("lines"),LimitType.CHARS=new LimitType("chars"),LimitType}(IIIFComponents.StringValue);MetadataComponentOptions.LimitType=LimitType}(MetadataComponentOptions=IIIFComponents.MetadataComponentOptions||(IIIFComponents.MetadataComponentOptions={}))}(IIIFComponents||(IIIFComponents={}));var IIIFComponents,__extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Manifold.MetadataGroup;!function(IIIFComponents){var MetadataComponent=function(_super){function MetadataComponent(options){var _this=_super.call(this,options)||this;return _this._data=_this.data(),_this._init(),_this._resize(),_this}return __extends(MetadataComponent,_super),MetadataComponent.prototype._init=function(){var success=_super.prototype._init.call(this);return success||console.error("Component failed to initialise"),this._$metadataGroupTemplate=$('<div class="group">                                                   <div class="header"></div>                                                   <div class="items"></div>                                               </div>'),this._$metadataItemTemplate=$('<div class="item">                                                   <div class="label"></div>                                                   <div class="values"></div>                                               </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this._data.content.copyToClipboard+'" title="'+this._data.content.copyToClipboard+'">                                                   <div class="copiedText">'+this._data.content.copiedToClipboard+" </div>                                               </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this._data.content.noData+"</div>"),this._$element.append(this._$noData),success},MetadataComponent.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:IIIFComponents.MetadataComponentOptions.LimitType.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(html){return html},showAllLanguages:!1}},MetadataComponent.prototype._getManifestGroup=function(){return this._metadataGroups.en().where(function(x){return x.resource.isManifest()}).first()},MetadataComponent.prototype._getCanvasGroups=function(){return this._metadataGroups.en().where(function(x){return x.resource.isCanvas()}).toArray()},MetadataComponent.prototype.set=function(data){var _this=this;if($.extend(this._data,data),this._data&&this._data.helper){var options={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(options),this._data.manifestDisplayOrder){var manifestGroup=this._getManifestGroup();manifestGroup.items=this._sortItems(manifestGroup.items,this._readCSV(this._data.manifestDisplayOrder))}if(this._data.canvasDisplayOrder){var canvasGroups=this._getCanvasGroups();canvasGroups.forEach(function(canvasGroup,index){canvasGroup.items=_this._sortItems(canvasGroup.items,_this._readCSV(_this._data.canvasDisplayOrder))})}if(this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude){var manifestGroup=this._getManifestGroup();manifestGroup.items=this._exclude(manifestGroup.items,this._readCSV(this._data.manifestExclude))}if(this._data.canvasExclude){var canvasGroups=this._getCanvasGroups();canvasGroups.forEach(function(canvasGroup,index){canvasGroup.items=_this._exclude(canvasGroup.items,_this._readCSV(_this._data.canvasExclude))})}if(this._data.limitToRange){var newGroups_1=[];this._metadataGroups.forEach(function(group,index){group.resource.isRange()&&newGroups_1.push(group)}),newGroups_1.length&&(this._metadataGroups=newGroups_1)}this._render()}},MetadataComponent.prototype._sortItems=function(items,displayOrder){var _this=this,sorted=[],unsorted=items.slice(0);return displayOrder.forEach(function(item,index){var match=unsorted.en().where(function(x){return _this._normalise(x.getLabel())===item}).first();if(match){sorted.push(match);var index_1=unsorted.indexOf(match);index_1>-1&&unsorted.splice(index_1,1)}}),unsorted.forEach(function(item,index){sorted.push(item)}),sorted},MetadataComponent.prototype._sortGroups=function(groups,metadataGroupOrder){var sorted=[],unsorted=groups.slice(0);return metadataGroupOrder.forEach(function(group,index){var match=unsorted.en().where(function(x){return x.resource.constructor.name.toLowerCase()==group}).first();if(match){sorted.push(match);var index_2=unsorted.indexOf(match);index_2>-1&&unsorted.splice(index_2,1)}}),sorted},MetadataComponent.prototype._label=function(groups,labels){groups.forEach(function(group,index){group.label=labels[index]})},MetadataComponent.prototype._exclude=function(items,excludeConfig){var _this=this;return excludeConfig.forEach(function(item,index){var match=items.en().where(function(x){return _this._normalise(x.getLabel())===item}).first();if(match){var index_3=items.indexOf(match);index_3>-1&&items.splice(index_3,1)}}),items},MetadataComponent.prototype._normalise=function(value){return value?value.toLowerCase().replace(/ /g,""):null},MetadataComponent.prototype._render=function(){var _this=this;return this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),void this._metadataGroups.forEach(function(metadataGroup,index){var $metadataGroup=_this._buildMetadataGroup(metadataGroup);_this._$metadataGroups.append($metadataGroup),_this._data.limitType===IIIFComponents.MetadataComponentOptions.LimitType.LINES?$metadataGroup.find(".value").toggleExpandTextByLines(_this._data.limit,_this._data.content.less,_this._data.content.more,function(){}):_this._data.limitType===IIIFComponents.MetadataComponentOptions.LimitType.CHARS&&$metadataGroup.find(".value").ellipsisHtmlFixed(_this._data.limit,function(){})})):void this._$noData.show()},MetadataComponent.prototype._buildMetadataGroup=function(metadataGroup){var $metadataGroup=this._$metadataGroupTemplate.clone(),$header=$metadataGroup.find(">.header");if(metadataGroup.resource.isManifest()&&this._data.content.manifestHeader)$header.html(this._sanitize(this._data.content.manifestHeader));else if(metadataGroup.resource.isSequence()&&this._data.content.sequenceHeader)$header.html(this._sanitize(this._data.content.sequenceHeader));else if(metadataGroup.resource.isRange()&&this._data.content.rangeHeader)$header.html(this._sanitize(this._data.content.rangeHeader));else if(metadataGroup.resource.isCanvas()&&(metadataGroup.label||this._data.content.canvasHeader)){var header=metadataGroup.label||this._data.content.canvasHeader;$header.html(this._sanitize(header))}else metadataGroup.resource.isAnnotation()&&this._data.content.imageHeader&&$header.html(this._sanitize(this._data.content.imageHeader));$header.text()||$header.hide();for(var $items=$metadataGroup.find(".items"),i=0;i<metadataGroup.items.length;i++){var item=metadataGroup.items[i],$metadataItem=this._buildMetadataItem(item);$items.append($metadataItem)}return $metadataGroup},MetadataComponent.prototype._buildMetadataItem=function(item){var $metadataItem=this._$metadataItemTemplate.clone(),$label=$metadataItem.find(".label"),$values=$metadataItem.find(".values"),originalLabel=item.getLabel(),label=originalLabel,urlPattern=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(label&&item.isRootLevel)switch(label.toLowerCase()){case"attribution":label=this._data.content.attribution;break;case"description":label=this._data.content.description;break;case"license":label=this._data.content.license;break;case"logo":label=this._data.content.logo}label=this._sanitize(label),$label.html(label),this._addReadingDirection($label,this._getLabelLocale(item)),$metadataItem.addClass(Utils.Strings.toCssClass(label));var $value;if(originalLabel&&"license"===originalLabel.toLowerCase()&&null!==urlPattern.exec(item.value[0].value))$value=this._buildMetadataItemURIValue(item.value[0].value),$values.append($value);else if(this._data.showAllLanguages&&item.value&&item.value.length>1)for(var i=0;i<item.value.length;i++){var translation=item.value[i];$value=this._buildMetadataItemValue(translation.value,translation.locale),$values.append($value)}else{for(var valueLocale=this._getValueLocale(item),valueFound=!1,i=0;i<item.value.length;i++){var translation=item.value[i];valueLocale.toLowerCase()===translation.locale.toLowerCase()&&(valueFound=!0,$value=this._buildMetadataItemValue(translation.value,translation.locale),$values.append($value))}if(!valueFound){var translation=item.value[0];translation&&($value=this._buildMetadataItemValue(translation.value,translation.locale),$values.append($value))}}return this._data.copyToClipboardEnabled&&Utils.Clipboard.supportsCopy()&&$label.text()&&this._addCopyButton($metadataItem,$label,$values),$metadataItem},MetadataComponent.prototype._getLabelLocale=function(item){if(!this._data||!this._data.helper)return"";var defaultLocale=this._data.helper.options.locale;if(item.label.length){var labelLocale=item.label[0].locale;if(labelLocale.toLowerCase()!==defaultLocale.toLowerCase())return labelLocale}return defaultLocale},MetadataComponent.prototype._getValueLocale=function(item){if(!this._data||!this._data.helper)return"";var defaultLocale=this._data.helper.options.locale;return defaultLocale},MetadataComponent.prototype._buildMetadataItemValue=function(value,locale){value=this._sanitize(value),value=value.replace("\n","<br>");var $value=this._$metadataItemValueTemplate.clone();return $value.html(value),$value.targetBlank(),locale&&this._addReadingDirection($value,locale),$value},MetadataComponent.prototype._buildMetadataItemURIValue=function(value){value=this._sanitize(value);var $value=this._$metadataItemURIValueTemplate.clone();return $value.prop("href",value),$value.text(value),$value},MetadataComponent.prototype._addReadingDirection=function($elem,locale){locale=Manifesto.Utils.getInexactLocale(locale);var rtlLanguages=this._readCSV(this._data.rtlLanguageCodes),match=rtlLanguages.en().where(function(x){return x===locale}).toArray().length>0;match&&($elem.prop("dir","rtl"),$elem.addClass("rtl"))},MetadataComponent.prototype._addCopyButton=function($elem,$header,$values){var $copyBtn=this._$copyTextTemplate.clone(),$copiedText=$copyBtn.children();$header.append($copyBtn),Utils.Device.isTouch()?$copyBtn.show():($elem.on("mouseenter",function(){$copyBtn.show()}),$elem.on("mouseleave",function(){$copyBtn.hide()}),$copyBtn.on("mouseleave",function(){$copiedText.hide()}));var that=this,originalValue=$values.text();$copyBtn.on("click",function(e){that._copyItemValues($copyBtn,originalValue)})},MetadataComponent.prototype._copyItemValues=function($copyButton,originalValue){Utils.Clipboard.copy(originalValue);var $copiedText=$copyButton.find(".copiedText");$copiedText.show(),setTimeout(function(){$copiedText.hide()},this._data.copiedMessageDuration)},MetadataComponent.prototype._readCSV=function(config,normalise){void 0===normalise&&(normalise=!0);var csv=[];if(config&&(csv=config.split(","),normalise))for(var i=0;i<csv.length;i++)csv[i]=this._normalise(csv[i]);return csv},MetadataComponent.prototype._sanitize=function(html){return this._data.sanitizer(html)},MetadataComponent.prototype._resize=function(){},MetadataComponent}(_Components.BaseComponent);IIIFComponents.MetadataComponent=MetadataComponent}(IIIFComponents||(IIIFComponents={})),function(IIIFComponents){var MetadataComponent;!function(MetadataComponent){var Events=function(){function Events(){}return Events}();MetadataComponent.Events=Events}(MetadataComponent=IIIFComponents.MetadataComponent||(IIIFComponents.MetadataComponent={}))}(IIIFComponents||(IIIFComponents={})),function(g){g.IIIFComponents?(g.IIIFComponents.MetadataComponent=IIIFComponents.MetadataComponent,g.IIIFComponents.MetadataComponentOptions=IIIFComponents.MetadataComponentOptions):g.IIIFComponents=IIIFComponents}(global)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});